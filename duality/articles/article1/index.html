<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Article Page</title>
    <style>

      /* Top bar container */
  .top-bar {
    width: 100%;
    height: 60px; /* adjust height as needed */
    background-color: #333; /* dark background */
    display: flex;
    align-items: center;
    padding: 1 30px; /* horizontal padding */
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    position: fixed; /* stays at the top */
    top: 0;
    left: 0;
    z-index: 1000;
  }

  /* Logo image */
  .top-bar img {
    height: 40px; /* logo height */
    cursor: pointer;
    transition: transform 0.2s;
  }

  .top-bar img:hover {
    transform: scale(1.1); /* subtle hover effect */
  }

  /* Optional: content next to logo */
  .top-bar .title {
    color: white;
    font-size: 20px;
    font-weight: bold;
    margin-left: 15px;
  }

  /* Push body content below the bar */
  body {
    margin: 0;
    padding-top: 60px; /* same as top-bar height */
    font-family: sans-serif;
  }

  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    margin: 0;
    padding: 20px;
    background: #f2f4f8;
    color: #333;
    line-height: 1.6;
    user-select: none;
  }

  img {
    pointer-events: auto;
    -webkit-user-drag: none;
    user-drag: none;
  }

  h1, h2 {
    color: #222;
    margin-bottom: 15px;
  }

  p {
    margin-bottom: 16px;
  }

  .page-container {
    display: flex;
    gap: 40px;
    align-items: flex-start;
    flex-wrap: wrap;
  }

  .article-container {
  z-index: 0;
    top: 100px;
    flex-grow: 2;
    max-width: 700px;
    margin: 0 auto;
    padding: 25px;
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 6px 18px rgba(0,0,0,0.08);
    transition: transform 0.3s;
    position: relative;
  }

  /* .article-container:hover {
    transform: translateY(-3px);
  } */

  .article-header img {
    max-width: 100%;
    height: auto;
    border-radius: 8px;
    margin-bottom: 20px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  }

  #comments-title {
    top: 100px;
    position: relative;
  }

  #comments-container {
    width: 350px;
    flex-grow: 1;
    background-color: #fff;
    padding: 20px;
    top: 100px;
    position: relative;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
  }

  .comment {
    margin-bottom: 18px;
    padding-bottom: 12px;
    border-bottom: 1px solid #eee;
    transition: background 0.2s;
    border-radius: 6px;
    padding: 10px;
  }

  .comment:hover {
    background-color: #f9f9f9;
  }

  .comment-author {
    font-weight: bold;
    color: #0077cc;
    margin-bottom: 4px;
  }

  .comment-text {
    font-size: 14px;
  }

  #drawing-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 1000;
  }

  .rectangle {
    position: absolute;
    border: 2px solid #ff4d4f;
    background-color: rgba(255, 77, 79, 0.2);
    border-radius: 4px;
  }

  #version {
    position: fixed;
    bottom: 10px;
    left: 10px;
    font-size: 14px;
    color: #555;
    background: rgba(255, 255, 255, 0.8);
    padding: 4px 8px;
    border-radius: 6px;
    font-family: sans-serif;
    z-index: 1000;
  }

  /* Sources styling */
  .sources-container {
    margin-top: 40px;
    max-width: 700px;
    margin: 0 auto;
    /*margin-right: auto;*/
  }

  .sources-container ul {
    list-style: none;
    padding: 0;
    display: grid;
    gap: 12px;
  }

  .sources-container li {
    background: #b29d9d;
    padding: 12px 16px;
    border-radius: 10px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.06);
    display: flex;
    align-items: center;
    transition: transform 0.2s, box-shadow 0.2s;
    cursor: pointer;
  }

  .sources-container li:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.12);
  }

  .sources-container li::before {
    content: "ðŸ“Œ";
    margin-right: 10px;
    font-size: 16px;
  }
</style>
<link rel="icon" href="/img/favicon.ico">
</head>
<body>
  <div id="version">duality v0.1.0</div>
  <div id="drawing-overlay"></div>

  <div class="top-bar">
    <!-- Clickable logo -->
    <a href="https://10tothe6.github.io/duality">
      <img src="https://github.com/10tothe6/10tothe6.github.io/blob/main/img/duality_logo.png?raw=true" alt="Home Logo">
    </a>

    <h3 id="status">Not logged in</h3>
  <button id = 'login-button'>Log In</button>
  <button id = 'signup-button'>Sign Up</button>
  <button id = 'logout-button'>Log Out</button>
  </div>

  <div class="page-container">
    <div class="article-container">
      <div class="article-header">
        <img src="https://github.com/10tothe6/10tothe6.github.io/blob/main/img/rosetta.png?raw=true" alt="Article Header Image">
      </div>
      <div class="article-content">
        <h1>Landing On A Comet</h1>
        <p>In 2014, the probe that ESA launched in 2004 - Rosetta - with the Philae lander that it carried, made contact with a comet out in deep space.</p>
        <p>
          Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aenean quis tincidunt lacus. Morbi gravida erat dapibus est convallis, et tincidunt tortor tincidunt. Cras sapien nisl, laoreet a lectus sed, molestie consectetur justo. Cras in dapibus nisi. Ut mollis orci a tempus rhoncus. Proin commodo ultricies mi, id semper magna mollis at. Nulla non nibh iaculis, cursus urna sit amet, sollicitudin mauris. Donec dictum sodales nisl, eu egestas lacus congue quis. Integer tortor dui, posuere in tincidunt ac, luctus a lorem. Nam ac tortor mattis, maximus tortor ac, accumsan quam. Donec dui sapien, semper sit amet gravida a, interdum pretium magna. Fusce nisi orci, blandit et fermentum non, pharetra eget ante. Morbi eget varius orci, ac cursus justo.
        </p>
        <p>
          Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Nulla dui dolor, laoreet lacinia commodo at, laoreet quis libero. In sem purus, ultrices sed eros eget, fermentum elementum tellus. Nunc pulvinar justo a velit porttitor ultricies. Suspendisse vel risus sit amet augue mattis facilisis. Proin vel mi lorem. Phasellus rhoncus ac mi ac vulputate.
        </p>

        <p>
          Vivamus volutpat tellus auctor tellus gravida volutpat. Nulla lobortis ante vitae nibh dignissim semper. Sed ac tempor nibh, sed malesuada sapien. Proin dui felis, sollicitudin id nisi nec, hendrerit pellentesque mi. Suspendisse lectus metus, feugiat at nunc eget, semper imperdiet leo. Cras vel rutrum neque. Mauris varius ultrices nisi, eget ultrices lacus mattis eget. Nunc tristique, erat non consequat mattis, libero dolor venenatis velit, non fringilla sapien nibh in dui. Duis sollicitudin turpis nec erat placerat, vitae suscipit sem ultrices. Sed efficitur, dolor vitae eleifend pellentesque, velit odio auctor elit, ut congue libero ligula sit amet magna. Fusce facilisis, tellus in pharetra placerat, neque neque convallis odio, eget porttitor sem augue non ligula. Suspendisse lectus erat, feugiat malesuada erat id, blandit finibus neque.
        </p>

        <p>
          Ut turpis ligula, varius sit amet placerat at, feugiat vitae lacus. Donec semper felis risus, quis ultricies elit pulvinar non. Nulla pulvinar libero pharetra metus dapibus dapibus. Duis pharetra malesuada nisl, a aliquam eros ultrices ut. Aenean et nibh eleifend, euismod est at, consequat mi. Sed eleifend egestas nisi. Nam nec nulla ultrices nisi feugiat sollicitudin. Sed id purus at magna cursus faucibus. Sed fringilla imperdiet ante vitae facilisis. Nullam placerat, eros sit amet blandit lobortis, sem urna aliquet dolor, eget lacinia ante massa et erat. Vestibulum ultrices magna quis felis dictum, eget consequat metus cursus.
        </p>

        <p>
          Nam a elit eros. Proin porta at nisl ac faucibus. Aliquam egestas ligula quis ante blandit, sit amet interdum augue vestibulum. Ut mattis elit nec metus pretium, sed posuere nibh consequat. Suspendisse potenti. Donec varius erat sit amet interdum auctor. Nullam ornare at erat vel tempor. Vivamus fringilla a elit at tristique. Maecenas interdum lectus eget enim volutpat, vitae maximus arcu ornare. Aliquam eu rutrum risus. Sed dapibus pulvinar commodo. Cras ligula tortor, tincidunt at tristique eu, dictum at mi. Ut semper lorem a lobortis sagittis. Duis egestas velit ut arcu pulvinar scelerisque. Vivamus tincidunt purus a lorem pulvinar volutpat. Cras non nulla dui.
        </p>
      </div>
      <div class="sources-container">
    <h2>Sources</h2>
    <ul>
      <li>Astronomy Today</li>
      <li>ESA Official Reports</li>
      <li>Scientific Journals</li>
      <li>Space News Portal</li>
    </ul>
  </div>
    </div>

    <div>
      <h1 id = "comments-title">Comments</h1>
      <div id="comments-container"></div>
    </div>
  </div>

  <!-- Firebase SDKs -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js";
  import { getFirestore, collection, addDoc, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-firestore.js";
  import {
    getAuth,
    createUserWithEmailAndPassword,
    signInWithEmailAndPassword,
    signOut,
    onAuthStateChanged
  } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-auth.js";
  
  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
  // For Firebase JS SDK v7.20.0 and later, measurementId is optional
  const firebaseConfig = {
    apiKey: "AIzaSyArv-BB3H5pIZFZBANfFYFG1bBNxO0veeA",
    authDomain: "duality-articles.firebaseapp.com",
    projectId: "duality-articles",
    storageBucket: "duality-articles.firebasestorage.app",
    messagingSenderId: "497426954182",
    appId: "1:497426954182:web:8081f58e64d32048c3a4c7",
    measurementId: "G-TJ5TXZEQH5"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);
  const user = auth.currentUser;

    // Reference the comments collection
    const commentsContainer = document.getElementById("comments-container");

    // Create comment popup (hidden by default)
    const commentBox = document.createElement("div");
    commentBox.style.position = "absolute";
    commentBox.style.padding = "8px";
    commentBox.style.background = "white";
    commentBox.style.border = "1px solid #ccc";
    commentBox.style.borderRadius = "6px";
    commentBox.style.display = "none";
    commentBox.style.zIndex = 99999;

    const commentInput = document.createElement("input");
    commentInput.type = "text";
    commentInput.placeholder = "Write a comment...";
    commentInput.style.width = "180px";

    const saveBtn = document.createElement("button");
    saveBtn.textContent = "Save";
    saveBtn.style.marginLeft = "6px";
    saveBtn.style.cursor = "pointer";

    commentBox.appendChild(commentInput);
    commentBox.appendChild(saveBtn);
    document.body.appendChild(commentBox);

    function openCommentBox(x, y) {
    commentBox.style.left = x + "px";
    commentBox.style.top = y + "px";
    commentBox.style.display = "block";
    commentInput.value = "";
    commentInput.focus();
}

let docID = 1;

    function clamp(value, min, max) {
    return Math.min(Math.max(value, min), max);
    }

    async function loadComments(max, min) {
        commentsContainer.innerHTML = "";
        
      try {
        const querySnapshot = await getDocs(collection(db, "comments"));
        querySnapshot.forEach((doc) => {
            const data = doc.data();
        const val = clamp((data.upper + data.lower)/2, max, min);
          if (val > data.upper && val < data.lower && data.docID == docID) {
            
            const commentDiv = document.createElement("div");
            commentDiv.classList.add("comment");

            commentDiv.innerHTML = `
                <div class="comment-author">${data.author || "Anonymous"}</div>
                <div class="comment-text">${data.text || ""}</div>
            `;

            commentsContainer.appendChild(commentDiv);
          }
        });
      } catch (error) {
        console.error("Error loading comments:", error);
        commentsContainer.innerHTML = "<p>Failed to load comments.</p>";
      }
    }

    async function addComment(author, text, upper, lower) {
  try {
    const docRef = await addDoc(collection(db, "comments"), {
      author: author || "Anonymous",
      text: text || "",
      upper: upper || 0,
      lower: lower || 100,
      docID: 1,
    });
    console.log("Comment added with ID:", docRef.id);
  } catch (error) {
    console.error("Error adding comment:", error);
  }
}

    const overlay = document.getElementById("drawing-overlay");
  let startX, startY;
  let rect = null;
  let img = null;
  let isDrawing = false;

  function getEmailPrefix(email) {
  if (typeof email !== "string") return null;

  const atIndex = email.indexOf("@");
  if (atIndex === -1) return null; // no @ found â†’ invalid email

  return email.slice(0, atIndex);
}

  // Handle saving the comment
  saveBtn.addEventListener("click", () => {
      const text = commentInput.value.trim();
      if (text.length === 0) return;

      if (user) {
        addComment(getEmailPrefix(user.email), text, rect.offsetTop + window.scrollY, rect.offsetTop + rect.offsetHeight + window.scrollY);
      }

      commentBox.style.display = "none";
  });

  window.addEventListener("mousedown", (e) => {

    const el = document.elementFromPoint(event.clientX, event.clientY);
    const cursorStyle = window.getComputedStyle(el).cursor;

    if (cursorStyle === "default") {
      commentBox.style.display = "none";
    }

    if (cursorStyle !== "pointer") {
        isDrawing = true;
        startX = e.clientX;
        startY = e.clientY;

        // Remove existing rectangle if there is one
        if (rect) {
          overlay.innerHTML = "";
          rect = null;
        }

        // Create a new rectangle
        rect = document.createElement("div");
        rect.className = "rectangle";
        rect.style.left = `${startX}px`;
        rect.style.top = `${startY}px`;
        rect.style.width = "0px";
        rect.style.height = "0px";
        overlay.appendChild(rect);

        // Create image
        img = document.createElement("img");
        img.style.position = "absolute";
        img.src = "https://github.com/10tothe6/10tothe6.github.io/blob/main/img/comment_icon.png?raw=true"; // replace with your image URL
        img.style.width = "24px"; // adjust size as needed
        img.style.height = "24px";

        // Make it clickable
        img.style.cursor = "pointer";
        img.addEventListener("click", () => {
          openCommentBox(e.clientX, e.clientY);
        });

        overlay.appendChild(img);
    }
    
  });

  window.addEventListener("mousemove", (e) => {
    if (!isDrawing || !rect) return;

    const currentX = e.clientX;
    const currentY = e.clientY;

    const width = Math.abs(currentX - startX);
    const height = Math.abs(currentY - startY);
    rect.style.width = `${width}px`;
    rect.style.height = `${height}px`;

    rect.style.left = `${Math.min(currentX, startX)}px`;
    rect.style.top = `${Math.min(currentY, startY)}px`;

    // Position the image at top-right of the rectangle
    img.style.left = `${Math.min(currentX, startX) + width - 24}px`;
    img.style.top = `${Math.min(currentY, startY)}px`;
  });

  window.addEventListener("mouseup", () => {
    if (!rect) return;
    isDrawing = false;

    if (rect.offsetHeight < 10) {
      overlay.innerHTML = "";
      rect = null;
        loadComments(0, 9999);
    }
    else {
        loadComments(rect.offsetTop + window.scrollY, rect.offsetTop + rect.offsetHeight + window.scrollY);
    }
  });

  loadComments(0, 9999);
  </script>
</body>
</html